(function webpackUniversalModuleDefinition(root, factory) {
	if(typeof exports === 'object' && typeof module === 'object')
		module.exports = factory();
	else if(typeof define === 'function' && define.amd)
		define([], factory);
	else if(typeof exports === 'object')
		exports["core"] = factory();
	else
		root["core"] = factory();
})(self, () => {
return /******/ (() => { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ({

/***/ "./src/index.ts":
/*!**********************!*\
  !*** ./src/index.ts ***!
  \**********************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.processRules = exports.validateRule = exports.processVerbose = exports.verbosePlugin = exports.processGroup = exports.processRuleOrGroup = exports.internalOperators = exports.processResult = exports.flattenKeys = exports.isGroup = exports.internalOperatorValues = void 0;
exports.internalOperatorValues = ['eq', 'neq', 'gt', 'lt', 'gte', 'lte', 'has', 'nhas', 'in', 'nit'];
const defaultDelimiter = '.';
function isGroup(testRule = {}) {
    const { all, any } = testRule;
    if (all || any)
        return true;
    return false;
}
exports.isGroup = isGroup;
function flattenKeys(obj, prefix = '', delimiter = '.') {
    return Object.entries(obj).reduce((acc, [key, value]) => {
        if (typeof value === 'object' && !Array.isArray(value)) {
            return { ...acc, ...flattenKeys(value, `${prefix}${key}${delimiter}`) };
        }
        return { ...acc, [`${prefix}${key}`]: value };
    }, {});
}
exports.flattenKeys = flattenKeys;
const processResult = ({ pass, facts, rule, group, plugins = [] }) => (plugins.reduce((pluginResult, plugin) => ({ ...pluginResult, ...(plugin({ pass, facts, rule, group }) || {}) }), { pass }));
exports.processResult = processResult;
const in_nit = (operator) => ({ value, term }) => {
    if (Array.isArray(term) || ['string', 'object'].includes(typeof term)) {
        const pass = term.includes(value);
        return operator === 'in' ? pass : !pass;
    }
    return false;
};
const has_nhas = (operator) => ({ value, term }) => {
    if (['number', 'bigint', 'symbol', 'undefined'].includes(typeof value))
        return false;
    const pass = value.includes(term);
    return (operator === 'has') ? pass : !pass;
};
exports.internalOperators = {
    eq: ({ value, term }) => value === term,
    neq: ({ value, term }) => value !== term,
    gt: ({ value, term }) => value > term,
    gte: ({ value, term }) => value >= term,
    lt: ({ value, term }) => value < term,
    lte: ({ value, term }) => value <= term,
    in: in_nit('in'),
    nit: in_nit('nit'),
    has: has_nhas('has'),
    nhas: has_nhas('nhas')
};
function processRuleOrGroup(facts = {}, rule, options = {}) {
    const { plugins = [], operators = {} } = options;
    if (isGroup(rule))
        return processGroup(facts, rule, { plugins });
    const [subject, op, term] = rule;
    if (subject === null || subject === undefined || !op) {
        throw new Error(`Invalid Rule\n${JSON.stringify(rule, null, 2)}`);
    }
    const ruleResult = { pass: false };
    const value = facts?.[subject];
    const valueType = typeof value;
    const termIsObject = typeof term == 'object';
    const termIsRule = termIsObject && isGroup(term);
    const factQuery = {
        value,
        type: valueType,
        queryFields: null
    };
    if (subject.indexOf(defaultDelimiter) > 0) {
        const flatFacts = flattenKeys(facts);
        const queryValue = flatFacts[subject];
        const objType = typeof queryValue;
        if (queryValue) {
            factQuery.value = queryValue;
            factQuery.type = Array.isArray(queryValue) ? 'array' : objType;
        }
    }
    if (termIsRule) {
    }
    const isNumeric = factQuery.type === 'bigint' || factQuery.type === 'number';
    const termValue = isNumeric ? parseInt(term, 10) : term;
    const factValue = factQuery.value;
    if (exports.internalOperators[op]) {
        ruleResult.pass = exports.internalOperators[op]({ value: factValue, term: termValue });
    }
    if (operators[op]) {
        ruleResult.pass = operators[op]({ value: factValue, term: termValue });
    }
    return (0, exports.processResult)({
        ...ruleResult, rule, facts, plugins
    });
}
exports.processRuleOrGroup = processRuleOrGroup;
function processGroup(facts = {}, ruleGroup = {}, options = {}) {
    const { all, any } = ruleGroup;
    const { plugins = [] } = options;
    const action = rule => processRuleOrGroup(facts, rule, options);
    if (all) {
        const groupResult = all.map(action);
        const pass = groupResult.every(r => r.pass);
        return (0, exports.processResult)({ pass, rule: ruleGroup, facts, plugins, group: { all: groupResult, pass } });
    }
    if (any) {
        const groupResult = any.map(action);
        const pass = groupResult.some(r => r.pass);
        return (0, exports.processResult)({ pass, rule: ruleGroup, facts, plugins, group: { any: groupResult, pass } });
    }
    throw new Error(`Invalid RuleGroup\n${JSON.stringify(ruleGroup, null, 2)}`);
}
exports.processGroup = processGroup;
const verbosePlugin = ({ pass, rule, group }) => ({ pass, rule, group });
exports.verbosePlugin = verbosePlugin;
const processVerbose = (facts = {}, ruleGroup, plugins = []) => (processGroup(facts, ruleGroup, { plugins: [exports.verbosePlugin, ...plugins] }));
exports.processVerbose = processVerbose;
function validateRule(ruleGroup = {}) {
    const isValid = false;
    if (!ruleGroup)
        return ({
            isValid,
            message: 'No Rule Group Found'
        });
    const { all, any } = ruleGroup;
    const validateRuleSet = (rules) => {
        if (rules.length === 0)
            return ({
                isValid,
                message: 'No Rule Group Found'
            });
        for (let ruleIndex = 0; ruleIndex < rules.length; ruleIndex++) {
            const ruleGroup = rules[ruleIndex];
            if (ruleGroup?.all || ruleGroup?.any) {
                return validateRule(ruleGroup);
            }
            const rule = ruleGroup;
            if (!Array.isArray(rule) || rule.length < 2)
                return ({
                    isValid,
                    message: 'No Rule Group Found'
                });
            const [field, op] = rule;
            if (!field || !op)
                return ({
                    isValid,
                    message: 'Invalid Rule'
                });
            if (!exports.internalOperatorValues.includes(op))
                return ({
                    isValid,
                    message: 'Invalid Operator'
                });
        }
        return {
            isValid: true
        };
    };
    if (all || any) {
        return validateRuleSet(all || any);
    }
    return ({
        isValid,
        message: 'No Quantifiers (all|any) Found'
    });
}
exports.validateRule = validateRule;
exports.processRules = processGroup;
exports["default"] = exports.processRules;


/***/ })

/******/ 	});
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module is referenced by other modules so it can't be inlined
/******/ 	var __webpack_exports__ = {};
/******/ 	__webpack_modules__["./src/index.ts"](0, __webpack_exports__);
/******/ 	
/******/ 	return __webpack_exports__;
/******/ })()
;
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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dWxlRGVmaW5pdGlvbiIsIndlYnBhY2s6Ly9jb3JlLy4vc3JjL2luZGV4LnRzIiwid2VicGFjazovL2NvcmUvd2VicGFjay9iZWZvcmUtc3RhcnR1cCIsIndlYnBhY2s6Ly9jb3JlL3dlYnBhY2svc3RhcnR1cCIsIndlYnBhY2s6Ly9jb3JlL3dlYnBhY2svYWZ0ZXItc3RhcnR1cCJdLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gd2VicGFja1VuaXZlcnNhbE1vZHVsZURlZmluaXRpb24ocm9vdCwgZmFjdG9yeSkge1xuXHRpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIG1vZHVsZSA9PT0gJ29iamVjdCcpXG5cdFx0bW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCk7XG5cdGVsc2UgaWYodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKVxuXHRcdGRlZmluZShbXSwgZmFjdG9yeSk7XG5cdGVsc2UgaWYodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnKVxuXHRcdGV4cG9ydHNbXCJjb3JlXCJdID0gZmFjdG9yeSgpO1xuXHRlbHNlXG5cdFx0cm9vdFtcImNvcmVcIl0gPSBmYWN0b3J5KCk7XG59KShzZWxmLCAoKSA9PiB7XG5yZXR1cm4gIiwiZXhwb3J0IHR5cGUgU3ViamVjdCA9IHN0cmluZztcclxuZXhwb3J0IHR5cGUgVGVybSA9IGFueTtcclxuZXhwb3J0IHR5cGUgUnVsZSA9IFtTdWJqZWN0LCBPcGVyYXRvciwgVGVybV07XHJcbmV4cG9ydCB0eXBlIFF1YW50aWZpZXJzID0gJ2FsbCcgfCAnYW55JztcclxuZXhwb3J0IHR5cGUgT3BlcmF0b3IgPSAnZXEnIHwgJ25lcScgfCAnZ3QnIHwgJ2x0JyB8ICdndGUnIHwgJ2x0ZScgfCAnaGFzJyB8ICduaGFzJyB8ICdpbicgfCAnbml0JyB8IHN0cmluZztcclxuZXhwb3J0IHR5cGUgUnVsZXMgPSAoUnVsZSB8IFJ1bGVHcm91cClbXTtcclxuZXhwb3J0IHR5cGUgUnVsZUdyb3VwID0geyBhbGw/OiBSdWxlcywgYW55PzogUnVsZXMgfTtcclxuZXhwb3J0IHR5cGUgRmFjdHMgPSBSZWNvcmQ8c3RyaW5nLCBhbnk+IHwgUmVjb3JkPHN0cmluZywgYW55PltdO1xyXG5leHBvcnQgdHlwZSBSZXN1bHRQbHVnaW4gPSAoYXJnczogUGx1Z2luQXJncykgPT4gUHJvY2Vzc1Jlc3VsdDtcclxuZXhwb3J0IHR5cGUgT3BlcmF0b3JQbHVnaW4gPSBSZWNvcmQ8c3RyaW5nLCAoYXJnczogT3BlcmF0b3JGdW5jQXJncykgPT4gYm9vbGVhbj47XHJcbmV4cG9ydCB0eXBlIE9wZXJhdG9yRnVuY0FyZ3MgPSB7XHJcbiAgdmFsdWU6IGFueTtcclxuICB0ZXJtOiBhbnk7XHJcbn1cclxuZXhwb3J0IHR5cGUgUGx1Z2luQXJncyA9IHtcclxuICBwYXNzOiBib29sZWFuO1xyXG4gIHJ1bGU6IFJ1bGUgfCBSdWxlR3JvdXA7XHJcbiAgZmFjdHM/OiBGYWN0cztcclxuICBncm91cD86IGFueTtcclxufTtcclxuZXhwb3J0IGludGVyZmFjZSBQcm9jZXNzQXJncyBleHRlbmRzIFBsdWdpbkFyZ3MgeyBwbHVnaW5zOiBSZXN1bHRQbHVnaW5bXSB9XHJcbmV4cG9ydCBpbnRlcmZhY2UgUHJvY2Vzc1Jlc3VsdCBleHRlbmRzIFJlY29yZDxzdHJpbmcsIGFueT4geyBwYXNzOiBib29sZWFuIH1cclxuZXhwb3J0IGludGVyZmFjZSBSdWxlRXZhbHVhdGlvbiB7IGlzVmFsaWQ6IGJvb2xlYW47IG1lc3NhZ2U/OiBzdHJpbmc7IH1cclxuZXhwb3J0IGludGVyZmFjZSBPcHRpb25zIHtcclxuICBwbHVnaW5zPzogUmVzdWx0UGx1Z2luW107XHJcbiAgb3BlcmF0b3JzPzogT3BlcmF0b3JQbHVnaW47XHJcbn1cclxuZXhwb3J0IHR5cGUgVmFsdWVUeXBlID0gJ3N0cmluZycgfCAnbnVtYmVyJyB8ICdiaWdpbnQnIHwgJ2Jvb2xlYW4nIHwgJ3N5bWJvbCcgfCAndW5kZWZpbmVkJyB8ICdvYmplY3QnIHwgJ2Z1bmN0aW9uJyB8ICdhcnJheSc7XHJcbmV4cG9ydCBjb25zdCBpbnRlcm5hbE9wZXJhdG9yVmFsdWVzOiBPcGVyYXRvcltdID0gWydlcScsICduZXEnLCAnZ3QnLCAnbHQnLCAnZ3RlJywgJ2x0ZScsICdoYXMnLCAnbmhhcycsICdpbicsICduaXQnXTtcclxuXHJcbmNvbnN0IGRlZmF1bHREZWxpbWl0ZXIgPSAnLic7XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gaXNHcm91cCh0ZXN0UnVsZTogUnVsZSB8IFJ1bGVHcm91cCA9IHt9KTogYm9vbGVhbiB7XHJcbiAgY29uc3QgeyBhbGwsIGFueSB9ID0gdGVzdFJ1bGUgYXMgUnVsZUdyb3VwO1xyXG4gIGlmIChhbGwgfHwgYW55KSByZXR1cm4gdHJ1ZTtcclxuICByZXR1cm4gZmFsc2U7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBmbGF0dGVuS2V5cyhvYmo6IGFueSwgcHJlZml4ID0gJycsIGRlbGltaXRlciA9ICcuJyk6IFJlY29yZDxzdHJpbmcsIGFueT4ge1xyXG4gIHJldHVybiBPYmplY3QuZW50cmllcyhvYmopLnJlZHVjZSgoYWNjLCBba2V5LCB2YWx1ZV0pID0+IHtcclxuICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmICFBcnJheS5pc0FycmF5KHZhbHVlKSkge1xyXG4gICAgICByZXR1cm4geyAuLi5hY2MsIC4uLmZsYXR0ZW5LZXlzKHZhbHVlLCBgJHtwcmVmaXh9JHtrZXl9JHtkZWxpbWl0ZXJ9YCkgfTtcclxuICAgIH1cclxuICAgIHJldHVybiB7IC4uLmFjYywgW2Ake3ByZWZpeH0ke2tleX1gXTogdmFsdWUgfTtcclxuICB9LCB7fSlcclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IHByb2Nlc3NSZXN1bHQgPSAoeyBwYXNzLCBmYWN0cywgcnVsZSwgZ3JvdXAsIHBsdWdpbnMgPSBbXSBhcyBSZXN1bHRQbHVnaW5bXSB9OiBQcm9jZXNzQXJncyk6IFByb2Nlc3NSZXN1bHQgPT4gKFxyXG4gIHBsdWdpbnMucmVkdWNlKChwbHVnaW5SZXN1bHQsIHBsdWdpbikgPT4gKHsgLi4ucGx1Z2luUmVzdWx0LCAuLi4ocGx1Z2luKHsgcGFzcywgZmFjdHMsIHJ1bGUsIGdyb3VwIH0pIHx8IHt9KSB9KSwgeyBwYXNzIH0pXHJcbilcclxuXHJcbmNvbnN0IGluX25pdCA9IChvcGVyYXRvcjogT3BlcmF0b3IpID0+ICh7IHZhbHVlLCB0ZXJtIH0pID0+IHtcclxuICBpZiAoQXJyYXkuaXNBcnJheSh0ZXJtKSB8fCBbJ3N0cmluZycsICdvYmplY3QnXS5pbmNsdWRlcyh0eXBlb2YgdGVybSkpIHtcclxuICAgIGNvbnN0IHBhc3MgPSB0ZXJtLmluY2x1ZGVzKHZhbHVlKTtcclxuICAgIHJldHVybiBvcGVyYXRvciA9PT0gJ2luJyA/IHBhc3MgOiAhcGFzcztcclxuICB9XHJcbiAgcmV0dXJuIGZhbHNlO1xyXG59XHJcblxyXG5jb25zdCBoYXNfbmhhcyA9IChvcGVyYXRvcjogT3BlcmF0b3IpID0+ICh7IHZhbHVlLCB0ZXJtIH0pID0+IHtcclxuICBpZiAoWydudW1iZXInLCAnYmlnaW50JywgJ3N5bWJvbCcsICd1bmRlZmluZWQnXS5pbmNsdWRlcyh0eXBlb2YgdmFsdWUpKSByZXR1cm4gZmFsc2U7XHJcbiAgY29uc3QgcGFzcyA9IHZhbHVlLmluY2x1ZGVzKHRlcm0pO1xyXG4gIHJldHVybiAob3BlcmF0b3IgPT09ICdoYXMnKSA/IHBhc3MgOiAhcGFzcztcclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IGludGVybmFsT3BlcmF0b3JzID0ge1xyXG4gIGVxOiAoeyB2YWx1ZSwgdGVybSB9KSA9PiB2YWx1ZSA9PT0gdGVybSxcclxuICBuZXE6ICh7IHZhbHVlLCB0ZXJtIH0pID0+IHZhbHVlICE9PSB0ZXJtLFxyXG4gIGd0OiAoeyB2YWx1ZSwgdGVybSB9KSA9PiB2YWx1ZSA+IHRlcm0sXHJcbiAgZ3RlOiAoeyB2YWx1ZSwgdGVybSB9KSA9PiB2YWx1ZSA+PSB0ZXJtLFxyXG4gIGx0OiAoeyB2YWx1ZSwgdGVybSB9KSA9PiB2YWx1ZSA8IHRlcm0sXHJcbiAgbHRlOiAoeyB2YWx1ZSwgdGVybSB9KSA9PiB2YWx1ZSA8PSB0ZXJtLFxyXG4gIGluOiBpbl9uaXQoJ2luJyksXHJcbiAgbml0OiBpbl9uaXQoJ25pdCcpLFxyXG4gIGhhczogaGFzX25oYXMoJ2hhcycpLFxyXG4gIG5oYXM6IGhhc19uaGFzKCduaGFzJylcclxufSBhcyBPcGVyYXRvclBsdWdpbjtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBwcm9jZXNzUnVsZU9yR3JvdXAoZmFjdHM6IEZhY3RzID0ge30sIHJ1bGU6IFJ1bGUgfCBSdWxlR3JvdXAsIG9wdGlvbnM6IE9wdGlvbnMgPSB7fSk6IFByb2Nlc3NSZXN1bHQge1xyXG4gIGNvbnN0IHsgcGx1Z2lucyA9IFtdLCBvcGVyYXRvcnMgPSB7fSB9ID0gb3B0aW9ucztcclxuICBpZiAoaXNHcm91cChydWxlKSkgcmV0dXJuIHByb2Nlc3NHcm91cChmYWN0cywgcnVsZSBhcyBSdWxlR3JvdXAsIHsgcGx1Z2lucyB9KTtcclxuXHJcbiAgY29uc3QgW3N1YmplY3QsIG9wLCB0ZXJtXSA9IHJ1bGUgYXMgUnVsZTtcclxuICBpZiAoc3ViamVjdCA9PT0gbnVsbCB8fCBzdWJqZWN0ID09PSB1bmRlZmluZWQgfHwgIW9wKSB7XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgUnVsZVxcbiR7SlNPTi5zdHJpbmdpZnkocnVsZSwgbnVsbCwgMil9YCk7XHJcbiAgfVxyXG5cclxuICBjb25zdCBydWxlUmVzdWx0ID0geyBwYXNzOiBmYWxzZSB9IGFzIFBsdWdpbkFyZ3M7XHJcbiAgY29uc3QgdmFsdWUgPSBmYWN0cz8uW3N1YmplY3RdO1xyXG4gIGNvbnN0IHZhbHVlVHlwZSA9IHR5cGVvZiB2YWx1ZSBhcyBWYWx1ZVR5cGU7XHJcbiAgY29uc3QgdGVybUlzT2JqZWN0ID0gdHlwZW9mIHRlcm0gPT0gJ29iamVjdCc7XHJcbiAgY29uc3QgdGVybUlzUnVsZSA9IHRlcm1Jc09iamVjdCAmJiBpc0dyb3VwKHRlcm0pO1xyXG4gIGNvbnN0IGZhY3RRdWVyeSA9IHtcclxuICAgIHZhbHVlLFxyXG4gICAgdHlwZTogdmFsdWVUeXBlLFxyXG4gICAgcXVlcnlGaWVsZHM6IG51bGxcclxuICB9XHJcblxyXG4gIC8vIGlmIGZpZWxkcyBjb250YWluIGRvdCByZWZzLCBsZXQncyBzZWUgaWYgdGhlcmUncyBhbiBvYmplY3QgdG8gcXVlcnlcclxuICBpZiAoc3ViamVjdC5pbmRleE9mKGRlZmF1bHREZWxpbWl0ZXIpID4gMCkge1xyXG4gICAgY29uc3QgZmxhdEZhY3RzID0gZmxhdHRlbktleXMoZmFjdHMpO1xyXG4gICAgY29uc3QgcXVlcnlWYWx1ZSA9IGZsYXRGYWN0c1tzdWJqZWN0XTtcclxuICAgIGNvbnN0IG9ialR5cGUgPSB0eXBlb2YgcXVlcnlWYWx1ZTtcclxuICAgIGlmIChxdWVyeVZhbHVlKSB7XHJcbiAgICAgIGZhY3RRdWVyeS52YWx1ZSA9IHF1ZXJ5VmFsdWU7XHJcbiAgICAgIGZhY3RRdWVyeS50eXBlID0gQXJyYXkuaXNBcnJheShxdWVyeVZhbHVlKSA/ICdhcnJheScgOiBvYmpUeXBlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgaWYgKHRlcm1Jc1J1bGUpIHtcclxuICAgIC8vIFRPRE86IGltcGxlbWVudCBuZXN0ZWQgcnVsZSBwcm9jZXNzaW5nIGFnYWluc3QgZmFjdCBsZWF2ZXNcclxuICB9XHJcblxyXG4gIGNvbnN0IGlzTnVtZXJpYyA9IGZhY3RRdWVyeS50eXBlID09PSAnYmlnaW50JyB8fCBmYWN0UXVlcnkudHlwZSA9PT0gJ251bWJlcic7XHJcbiAgY29uc3QgdGVybVZhbHVlID0gaXNOdW1lcmljID8gcGFyc2VJbnQodGVybSwgMTApIDogdGVybTtcclxuICBjb25zdCBmYWN0VmFsdWUgPSBmYWN0UXVlcnkudmFsdWU7XHJcblxyXG4gIGlmIChpbnRlcm5hbE9wZXJhdG9yc1tvcF0pIHtcclxuICAgIHJ1bGVSZXN1bHQucGFzcyA9IGludGVybmFsT3BlcmF0b3JzW29wXSh7IHZhbHVlOiBmYWN0VmFsdWUsIHRlcm06IHRlcm1WYWx1ZSB9KTtcclxuICB9XHJcblxyXG4gIC8vIGV2YWx1YXRlIHVzZXJzIG9wZXJhdG9yczsgd2hpY2ggY2FuIG92ZXJyaWRlIGludGVybmFsIG9wZXJhdG9ycyBcclxuICBpZiAob3BlcmF0b3JzW29wXSkge1xyXG4gICAgcnVsZVJlc3VsdC5wYXNzID0gb3BlcmF0b3JzW29wXSh7IHZhbHVlOiBmYWN0VmFsdWUsIHRlcm06IHRlcm1WYWx1ZSB9KTtcclxuICB9XHJcblxyXG4gIHJldHVybiBwcm9jZXNzUmVzdWx0KHtcclxuICAgIC4uLnJ1bGVSZXN1bHQsIHJ1bGUsIGZhY3RzLCBwbHVnaW5zXHJcbiAgfSBhcyBQcm9jZXNzQXJncyk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBcclxuICogSGVyZSBpcyBzYW1wbGUgb2Ygd2hhdCBjb25zdHJ1Y3RpbmcgYSBydWxlIG1hbnVhbGx5IGFnYWluc3QgYSBzbWFsbCBzZXQgb2YgZmFjdHMgd291bGQgbG9vayBsaWtlIGluIGphdmFzY3JpcHRcclxuICogXHJcbiAqIGBgYHRzXHJcbiAqICAgaW1wb3J0IHsgcHJvY2Vzc1J1bGVzIH0gZnJvbSAnQGljcnVsZXMvY29yZSc7XHJcbiAqIFxyXG4gKiAgIGNvbnN0IGZhY3RzID0geyBcclxuICogICAgIG1hcmtldDogJ2VuLVVTJywgXHJcbiAqICAgICBjb2xvcjogJ2JsdWUnLCBcclxuICogICAgIGRpYW1ldGVyOiAxMCBcclxuICogICB9O1xyXG4gKiBcclxuICogICBjb25zdCBydWxlcyA9IHsgXHJcbiAqICAgICBhbnk6IFtcclxuICogICAgICAgWydtYXJrZXQnLCAnZXEnLCAnZW4tVVMnXSwgXHJcbiAqICAgICAgIFsnZGlhbWV0ZXInLCAnZ3QnLCA1XVxyXG4gKiAgICAgXSBcclxuICogICB9O1xyXG4gKiBcclxuICogICBjb25zdCByZXN1bHQgPSBwcm9jZXNzUnVsZXMoZmFjdHMsIHJ1bGVzKTtcclxuICogICBcclxuICogICBpZihyZXN1bHRzLnBhc3Mpe1xyXG4gKiAgICAgLy8gZG8gdGhlIHRoaW5nIHRoYXQgbmVlZHMgZG9uZVxyXG4gKiAgIH1cclxuICogIFxyXG4gKiBgYGBcclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBwcm9jZXNzR3JvdXAoZmFjdHM6IEZhY3RzID0ge30sIHJ1bGVHcm91cDogUnVsZUdyb3VwID0ge30sIG9wdGlvbnM6IE9wdGlvbnMgPSB7fSk6IFByb2Nlc3NSZXN1bHQge1xyXG4gIGNvbnN0IHsgYWxsLCBhbnkgfSA9IHJ1bGVHcm91cDtcclxuICBjb25zdCB7IHBsdWdpbnMgPSBbXSB9ID0gb3B0aW9ucztcclxuICBjb25zdCBhY3Rpb24gPSBydWxlID0+IHByb2Nlc3NSdWxlT3JHcm91cChmYWN0cywgcnVsZSwgb3B0aW9ucyk7XHJcblxyXG4gIGlmIChhbGwpIHtcclxuICAgIGNvbnN0IGdyb3VwUmVzdWx0ID0gYWxsLm1hcChhY3Rpb24pO1xyXG4gICAgY29uc3QgcGFzcyA9IGdyb3VwUmVzdWx0LmV2ZXJ5KHIgPT4gci5wYXNzKTtcclxuICAgIHJldHVybiBwcm9jZXNzUmVzdWx0KHsgcGFzcywgcnVsZTogcnVsZUdyb3VwLCBmYWN0cywgcGx1Z2lucywgZ3JvdXA6IHsgYWxsOiBncm91cFJlc3VsdCwgcGFzcyB9IH0pO1xyXG4gIH1cclxuXHJcbiAgaWYgKGFueSkge1xyXG4gICAgY29uc3QgZ3JvdXBSZXN1bHQgPSBhbnkubWFwKGFjdGlvbik7XHJcbiAgICBjb25zdCBwYXNzID0gZ3JvdXBSZXN1bHQuc29tZShyID0+IHIucGFzcyk7XHJcbiAgICByZXR1cm4gcHJvY2Vzc1Jlc3VsdCh7IHBhc3MsIHJ1bGU6IHJ1bGVHcm91cCwgZmFjdHMsIHBsdWdpbnMsIGdyb3VwOiB7IGFueTogZ3JvdXBSZXN1bHQsIHBhc3MgfSB9KTtcclxuICB9XHJcblxyXG4gIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBSdWxlR3JvdXBcXG4ke0pTT04uc3RyaW5naWZ5KHJ1bGVHcm91cCwgbnVsbCwgMil9YCwpO1xyXG59XHJcblxyXG5leHBvcnQgY29uc3QgdmVyYm9zZVBsdWdpbiA9ICh7IHBhc3MsIHJ1bGUsIGdyb3VwIH06IFBsdWdpbkFyZ3MpID0+ICh7IHBhc3MsIHJ1bGUsIGdyb3VwIH0pO1xyXG5cclxuZXhwb3J0IGNvbnN0IHByb2Nlc3NWZXJib3NlID0gKGZhY3RzOiBGYWN0cyA9IHt9LCBydWxlR3JvdXA6IFJ1bGVHcm91cCwgcGx1Z2luczogUmVzdWx0UGx1Z2luW10gPSBbXSkgPT4gKFxyXG4gIHByb2Nlc3NHcm91cChmYWN0cywgcnVsZUdyb3VwLCB7IHBsdWdpbnM6IFt2ZXJib3NlUGx1Z2luLCAuLi5wbHVnaW5zXSB9KVxyXG4pO1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHZhbGlkYXRlUnVsZShydWxlR3JvdXAgPSB7fSBhcyBSdWxlR3JvdXApOiBSdWxlRXZhbHVhdGlvbiB7XHJcbiAgY29uc3QgaXNWYWxpZCA9IGZhbHNlO1xyXG4gIGlmICghcnVsZUdyb3VwKSByZXR1cm4gKHtcclxuICAgIGlzVmFsaWQsXHJcbiAgICBtZXNzYWdlOiAnTm8gUnVsZSBHcm91cCBGb3VuZCdcclxuICB9KTtcclxuICBjb25zdCB7IGFsbCwgYW55IH0gPSBydWxlR3JvdXA7XHJcblxyXG4gIGNvbnN0IHZhbGlkYXRlUnVsZVNldCA9IChydWxlczogUnVsZXMpID0+IHtcclxuICAgIGlmIChydWxlcy5sZW5ndGggPT09IDApIHJldHVybiAoe1xyXG4gICAgICBpc1ZhbGlkLFxyXG4gICAgICBtZXNzYWdlOiAnTm8gUnVsZSBHcm91cCBGb3VuZCdcclxuICAgIH0pO1xyXG4gICAgZm9yIChsZXQgcnVsZUluZGV4ID0gMDsgcnVsZUluZGV4IDwgcnVsZXMubGVuZ3RoOyBydWxlSW5kZXgrKykge1xyXG4gICAgICBjb25zdCBydWxlR3JvdXAgPSBydWxlc1tydWxlSW5kZXhdIGFzIFJ1bGVHcm91cDtcclxuICAgICAgaWYgKHJ1bGVHcm91cD8uYWxsIHx8IHJ1bGVHcm91cD8uYW55KSB7XHJcbiAgICAgICAgcmV0dXJuIHZhbGlkYXRlUnVsZShydWxlR3JvdXApO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCBydWxlID0gcnVsZUdyb3VwIGFzIFJ1bGU7XHJcbiAgICAgIGlmICghQXJyYXkuaXNBcnJheShydWxlKSB8fCBydWxlLmxlbmd0aCA8IDIpIHJldHVybiAoe1xyXG4gICAgICAgIGlzVmFsaWQsXHJcbiAgICAgICAgbWVzc2FnZTogJ05vIFJ1bGUgR3JvdXAgRm91bmQnXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgY29uc3QgW2ZpZWxkLCBvcF0gPSBydWxlO1xyXG4gICAgICBpZiAoIWZpZWxkIHx8ICFvcCkgcmV0dXJuICh7XHJcbiAgICAgICAgaXNWYWxpZCxcclxuICAgICAgICBtZXNzYWdlOiAnSW52YWxpZCBSdWxlJ1xyXG4gICAgICB9KVxyXG4gICAgICBpZiAoIWludGVybmFsT3BlcmF0b3JWYWx1ZXMuaW5jbHVkZXMob3ApKSByZXR1cm4gKHtcclxuICAgICAgICBpc1ZhbGlkLFxyXG4gICAgICAgIG1lc3NhZ2U6ICdJbnZhbGlkIE9wZXJhdG9yJ1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICAgIHJldHVybiB7XHJcbiAgICAgIGlzVmFsaWQ6IHRydWVcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBpZiAoYWxsIHx8IGFueSkge1xyXG4gICAgcmV0dXJuIHZhbGlkYXRlUnVsZVNldChhbGwgfHwgYW55KTtcclxuICB9XHJcblxyXG4gIHJldHVybiAoe1xyXG4gICAgaXNWYWxpZCxcclxuICAgIG1lc3NhZ2U6ICdObyBRdWFudGlmaWVycyAoYWxsfGFueSkgRm91bmQnXHJcbiAgfSk7XHJcbn1cclxuXHJcbi8qXHJcbmBgYFxyXG5cclxuYGBgXHJcbiovXHJcbmV4cG9ydCBjb25zdCBwcm9jZXNzUnVsZXMgPSBwcm9jZXNzR3JvdXA7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBwcm9jZXNzUnVsZXM7XHJcbiIsIiIsIi8vIHN0YXJ0dXBcbi8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuLy8gVGhpcyBlbnRyeSBtb2R1bGUgaXMgcmVmZXJlbmNlZCBieSBvdGhlciBtb2R1bGVzIHNvIGl0IGNhbid0IGJlIGlubGluZWRcbnZhciBfX3dlYnBhY2tfZXhwb3J0c19fID0ge307XG5fX3dlYnBhY2tfbW9kdWxlc19fW1wiLi9zcmMvaW5kZXgudHNcIl0oMCwgX193ZWJwYWNrX2V4cG9ydHNfXyk7XG4iLCIiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=